name: "redirect2me"
arch: "amd64"
platform: "linux"
version: "1.0.0"
section: "default"
priority: "optional"
maintainer: "Andrew Marcuse <fileformat@gmail.com>"
description: "Redirect2me worker node"
vendor: "Redirect2me"
homepage: "https://www.redirect2.me/"
license: "Proprietary"

# Files to include in the package
contents:
  - src: ../../tmp/build/redirect2me
    dst: /usr/local/bin/redirect2me
    file_info:
      mode: 0755
      owner: redirect2me
      group: redirect2me
  - src: ./redirect2me.service
    dst: /lib/systemd/system/redirect2me.service
    file_info:
      mode: 0644
  - src: ./redirect2me.logrotate
    dst: /etc/logrotate.d/redirect2me
    file_info:
      mode: 0644
  - src: ./config.yaml.sample
    dst: /etc/redirect2me/config.yaml
    type: config  # Prevents overwriting user's local changes on upgrade
    file_info:
      mode: 0644
  - dst: /var/log/redirect2me
    type: dir
    file_info:
      mode: 0750
      owner: redirect2me
      group: redirect2me

  # Data Directory
  - dst: /var/lib/redirect2me
    type: dir
    file_info:
      mode: 0750
      owner: redirect2me
      group: redirect2me
  - dst: /var/lib/redirect2me/certs
    type: dir
    file_info:
      mode: 0750
      owner: redirect2me
      group: redirect2me

# Scripts to handle service registration after installation
scripts:
  postinstall: ./postinstall.sh
  preremove: ./preremove.sh
  postremove: ./postremove.sh